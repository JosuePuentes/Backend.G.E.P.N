# Makefile para GEPN Backend

.PHONY: run build clean test docker-build docker-run help

# Variables
BINARY_NAME=app
MAIN_FILE=main.go

# Ejecutar la aplicaciÃ³n
run:
	@echo "ğŸš€ Ejecutando servidor GEPN..."
	@go run $(MAIN_FILE)

# Compilar la aplicaciÃ³n
build:
	@echo "ğŸ”¨ Compilando aplicaciÃ³n..."
	@go build -tags netgo -ldflags '-s -w' -o $(BINARY_NAME) $(MAIN_FILE)
	@echo "âœ… CompilaciÃ³n exitosa: $(BINARY_NAME)"

# Limpiar archivos compilados
clean:
	@echo "ğŸ§¹ Limpiando archivos..."
	@rm -f $(BINARY_NAME)
	@rm -f $(BINARY_NAME).exe
	@echo "âœ… Limpieza completada"

# Ejecutar tests
test:
	@echo "ğŸ§ª Ejecutando tests..."
	@go test -v ./...

# Formatear cÃ³digo
fmt:
	@echo "ğŸ“ Formateando cÃ³digo..."
	@go fmt ./...
	@echo "âœ… Formateo completado"

# Verificar cÃ³digo
vet:
	@echo "ğŸ” Verificando cÃ³digo..."
	@go vet ./...
	@echo "âœ… VerificaciÃ³n completada"

# Actualizar dependencias
deps:
	@echo "ğŸ“¦ Actualizando dependencias..."
	@go mod tidy
	@go mod download
	@echo "âœ… Dependencias actualizadas"

# Construir imagen Docker
docker-build:
	@echo "ğŸ³ Construyendo imagen Docker..."
	@docker build -t gepn-backend:latest .
	@echo "âœ… Imagen construida: gepn-backend:latest"

# Ejecutar contenedor Docker
docker-run:
	@echo "ğŸ³ Ejecutando contenedor Docker..."
	@docker run -p 8080:8080 --env PORT=8080 gepn-backend:latest

# Ayuda
help:
	@echo "ğŸ“‹ Comandos disponibles:"
	@echo "  make run          - Ejecutar la aplicaciÃ³n"
	@echo "  make build        - Compilar la aplicaciÃ³n"
	@echo "  make clean        - Limpiar archivos compilados"
	@echo "  make test         - Ejecutar tests"
	@echo "  make fmt          - Formatear cÃ³digo"
	@echo "  make vet          - Verificar cÃ³digo"
	@echo "  make deps         - Actualizar dependencias"
	@echo "  make docker-build - Construir imagen Docker"
	@echo "  make docker-run   - Ejecutar contenedor Docker"
	@echo "  make help         - Mostrar esta ayuda"


